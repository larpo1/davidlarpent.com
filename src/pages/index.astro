---
import { getCollection } from 'astro:content';
import Base from '../layouts/Base.astro';

// Get all posts, filter out drafts, and sort by date (newest first)
const allPosts = await getCollection('posts');
const posts = allPosts
  .filter(post => !post.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

// JSON-LD WebSite Schema
const websiteSchema = {
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "David Larpent",
  "description": "Essays on philosophy, AI, cognitive science, and more.",
  "url": "https://davidlarpent.com",
  "author": {
    "@type": "Person",
    "name": "David Larpent",
    "url": "https://davidlarpent.com/about"
  },
  "inLanguage": "en"
};
---

<Base title="David Larpent">
  <script slot="head" type="application/ld+json" set:html={JSON.stringify(websiteSchema)} />
  <ul class="post-list">
    {posts.map(post => {
      const formattedDate = post.data.date.toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'short',
        day: 'numeric'
      });

      return (
        <li class="post-list-item">
          <h2 class="post-list-title">
            <a href={`/posts/${post.slug}`}>{post.data.title}</a>
          </h2>
          <div class="post-meta">{formattedDate}</div>
          {post.data.description && (
            <p class="post-description">{post.data.description}</p>
          )}
          {post.data.tags && post.data.tags.length > 0 && (
            <div class="post-tags">
              {post.data.tags.map(tag => (
                <a href={`/tags/${tag.toLowerCase()}`} class="tag-link">
                  #{tag}
                </a>
              ))}
            </div>
          )}
        </li>
      );
    })}
  </ul>
</Base>
